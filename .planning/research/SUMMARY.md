# Research Summary: Surge-Safe Event Booking System

**Domain:** High-Concurrency Event Booking (1500+ bookings in <30 mins)
**Researched:** 2026-01-18
**Overall Confidence:** HIGH

## Executive Summary
Building a greenfield booking system that handles massive surges (e.g., ticket drops) requires a move away from traditional "open-to-all" architectures. The 2026 standard for Next.js/Vercel environments relies on a **three-tier safety net**:
1. **Edge-based Rate Limiting** to drop bot traffic early.
2. **Redis-based Waiting Room** to throttle legitimate traffic into manageable batches.
3. **Database Row-Level Locking** with `SKIP LOCKED` to ensure zero over-booking without timing out serverless functions.

The stack focuses on "stateless" tools (HTTP-based Redis, Serverless Postgres) to avoid the connection exhaustion common in lambda-based architectures.

## Key Findings
- **Stack:** Next.js 15+, Drizzle ORM, Neon/Vercel Postgres (with connection pooling), and Upstash Redis.
- **Architecture:** A "Virtual Queue" (Waiting Room) pattern is essential. Traffic should never hit the DB directly; it must flow through a Redis-backed admission controller.
- **Critical Pitfall:** Connection exhaustion is the #1 killer of serverless booking systems. Using standard TCP drivers for Postgres/Redis at scale will fail during the surge.

## Implications for Roadmap
Based on research, the following phase structure is recommended for the Surge-Safe project:

1. **Phase 1: Core Schema & Atomic Locking** - Implement the Postgres schema with Drizzle and verify `FOR UPDATE SKIP LOCKED` behavior for inventory.
2. **Phase 2: Redis Admission Control (Waiting Room)** - Build the Lua-scripted queue logic to throttle user admission.
3. **Phase 3: Real-time UI & SSE** - Implement Server-Sent Events to notify users of their queue status without polling.
4. **Phase 4: Payment Integration & Webhook Reliability** - Integrate Razorpay with idempotent webhook handling to ensure "Paid" status is synchronized with "Booked" status.

## Confidence Assessment

| Area | Confidence | Notes |
|------|------------|-------|
| Stack | HIGH | Drizzle + Upstash + Neon is the gold standard for this niche in 2026. |
| Features | HIGH | Standard features (Waiting Room, Timed Sessions) are well-documented. |
| Architecture | HIGH | The "Leaky Bucket" admission pattern is proven for high-concurrency. |
| Pitfalls | HIGH | Serverless connection limits are a known and solvable constraint. |

## Gaps to Address
- **Razorpay Surge Limits:** Researching if Razorpay's API itself has rate limits that might be hit during a 1500-booking surge.
- **Cold Start Latency:** Investigating if "Regional" vs "Edge" functions are better for the admission logic to minimize latency spikes.

---
*Generated by Antigravity Research Agent*
